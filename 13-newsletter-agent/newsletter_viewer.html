<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI & Gaming Newsletter Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .generate-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: bold;
        }
        .generate-btn:hover {
            background-color: #45a049;
        }
        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .status-success {
            background-color: #dff0d8;
            color: #3c763d;
            display: block;
        }
        .status-error {
            background-color: #f2dede;
            color: #a94442;
            display: block;
        }
        .status-progress {
            background-color: #d9edf7;
            color: #31708f;
            display: block;
        }
        h1 {
            color: #1E88E5;
            border-bottom: 2px solid #1E88E5;
            padding-bottom: 10px;
        }
        h2 {
            color: #7E57C2;
            margin-top: 1.5rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        h3 {
            color: #43A047;
        }
        .newsletter-content {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .star-filled {
            color: #FFD700;
        }
        .star-empty {
            color: #CCCCCC;
        }
        .article-list {
            list-style-type: none;
            padding-left: 0;
        }
        .article-list li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        .article-list li:before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #1E88E5;
        }
        .source {
            font-style: italic;
            color: #666;
        }
        .rating-section {
            background-color: #f0f2f6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 30px;
        }
        .file-selector {
            margin-bottom: 20px;
        }
        select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            width: 100%;
            max-width: 400px;
        }
    </style>
</head>
<body>
    <h1>AI & Gaming Newsletter Viewer ðŸ¤–ðŸŽ®</h1>
    
    <div class="file-selector">
        <h3>Select a Newsletter:</h3>
        <select id="newsletter-selector" onchange="loadNewsletter()">
            <!-- Options will be populated by JavaScript -->
        </select>
        <button id="generate-button" onclick="generateNewsletter()" class="generate-btn">Generate New Newsletter</button>
        <div id="generation-status" class="status-message"></div>
    </div>
    
    <div class="newsletter-content" id="newsletter-content">
        <!-- Newsletter content will be loaded here -->
        <p>Please select a newsletter to view.</p>
    </div>

    <script>
        // Function to load available newsletter files
        async function loadNewsletterFiles() {
            try {
                // List of known newsletter files to check
                const knownFiles = [
                    { file: 'newsletter_rated_20250508.md', name: 'Newsletter (May 8, 2025)' },
                    { file: 'newsletter_llm_20250508.md', name: 'LLM Newsletter (May 8, 2025)' },
                    { file: 'newsletter_bullets_20250508.md', name: 'Bullet Points (May 8, 2025)' },
                    { file: 'newsletter_20250508.md', name: 'Basic Newsletter (May 8, 2025)' },
                    
                    // Add previous weeks (we'll check if they exist)
                    { file: 'newsletter_rated_20250501.md', name: 'Newsletter (May 1, 2025)' },
                    { file: 'newsletter_rated_20250424.md', name: 'Newsletter (April 24, 2025)' },
                    { file: 'newsletter_rated_20250417.md', name: 'Newsletter (April 17, 2025)' },
                    { file: 'newsletter_rated_20250410.md', name: 'Newsletter (April 10, 2025)' },
                    { file: 'newsletter_rated_20250403.md', name: 'Newsletter (April 3, 2025)' },
                    { file: 'newsletter_rated_20250327.md', name: 'Newsletter (March 27, 2025)' }
                ];
                
                const selector = document.getElementById('newsletter-selector');
                let filesFound = 0;
                
                // Clear any existing options
                selector.innerHTML = '';
                
                // Add a manual file list for debugging
                const debugInfo = document.createElement('div');
                debugInfo.id = 'debug-info';
                debugInfo.style.display = 'none';
                debugInfo.innerHTML = '<h3>Available Files:</h3><ul>' +
                    '<li>newsletter_rated_20250508.md</li>' +
                    '<li>newsletter_llm_20250508.md</li>' +
                    '<li>newsletter_bullets_20250508.md</li>' +
                    '<li>newsletter_20250508.md</li>' +
                    '</ul>';
                document.body.appendChild(debugInfo);
                
                // Add a debug button
                const debugButton = document.createElement('button');
                debugButton.textContent = 'Show Available Files';
                debugButton.style.position = 'fixed';
                debugButton.style.bottom = '10px';
                debugButton.style.right = '10px';
                debugButton.style.zIndex = '1000';
                debugButton.style.padding = '5px';
                debugButton.style.fontSize = '12px';
                debugButton.onclick = function() {
                    const debugInfo = document.getElementById('debug-info');
                    if (debugInfo.style.display === 'none') {
                        debugInfo.style.display = 'block';
                        debugButton.textContent = 'Hide Files';
                    } else {
                        debugInfo.style.display = 'none';
                        debugButton.textContent = 'Show Available Files';
                    }
                };
                document.body.appendChild(debugButton);
                
                // Check each potential file with cache-busting
                for (const item of knownFiles) {
                    try {
                        // Add a timestamp to prevent caching
                        const cacheBuster = `?t=${new Date().getTime()}`;
                        const response = await fetch(item.file + cacheBuster);
                        
                        if (response.ok) {
                            // Add the file to the selector
                            const option = document.createElement('option');
                            option.value = item.file;
                            option.textContent = item.name;
                            selector.appendChild(option);
                            filesFound++;
                            
                            // Update debug info
                            const li = document.createElement('li');
                            li.textContent = `${item.file} - Found`;
                            li.style.color = 'green';
                            document.querySelector('#debug-info ul').appendChild(li);
                        }
                    } catch (e) {
                        // Ignore errors for files that don't exist
                        console.log(`File not found: ${item.file}`);
                    }
                }
                
                // Directly try to load specific files we know exist
                if (filesFound === 0) {
                    // Try direct file loading for the most recent newsletter
                    const directFiles = [
                        'newsletter_rated_20250508.md',
                        'newsletter_llm_20250508.md',
                        'newsletter_bullets_20250508.md',
                        'newsletter_20250508.md'
                    ];
                    
                    for (const file of directFiles) {
                        const option = document.createElement('option');
                        option.value = file;
                        option.textContent = `${file} (Direct Load)`;
                        selector.appendChild(option);
                        filesFound++;
                    }
                }
                
                if (filesFound > 0) {
                    // Load the first newsletter in the list
                    loadNewsletter();
                } else {
                    document.getElementById('newsletter-content').innerHTML = 
                        '<p>No newsletter files found. Click the "Generate New Newsletter" button to create one.</p>' +
                        '<p>If you already generated a newsletter, try refreshing the page with Ctrl+F5 or Cmd+Shift+R to clear the cache.</p>';
                }
            } catch (error) {
                console.error('Error loading newsletter files:', error);
                document.getElementById('newsletter-content').innerHTML = 
                    `<p>Error loading newsletter files: ${error.message}</p>` +
                    '<p>Try refreshing the page with Ctrl+F5 or Cmd+Shift+R to clear the cache.</p>';
            }
        }

        // Function to load the selected newsletter
        async function loadNewsletter() {
            const selector = document.getElementById('newsletter-selector');
            const selectedFile = selector.value;
            const contentElement = document.getElementById('newsletter-content');
            
            if (!selectedFile) {
                contentElement.innerHTML = '<p>Please select a newsletter to view.</p>';
                return;
            }
            
            // Show loading indicator
            contentElement.innerHTML = '<p>Loading newsletter...</p>';
            
            try {
                // Add cache-busting parameter
                const cacheBuster = `?t=${new Date().getTime()}`;
                const response = await fetch(selectedFile + cacheBuster);
                
                if (response.ok) {
                    let content = await response.text();
                    
                    // Log the raw content for debugging
                    console.log('Raw content length:', content.length);
                    console.log('Raw content preview:', content.substring(0, 100));
                    
                    if (content.length === 0) {
                        contentElement.innerHTML = '<p>The newsletter file is empty. Please try generating it again.</p>';
                        return;
                    }
                    
                    // Convert markdown to HTML (very basic conversion)
                    content = convertMarkdownToHtml(content);
                    
                    // Replace star ratings with colored stars
                    content = content.replace(/â˜…/g, '<span class="star-filled">â˜…</span>');
                    content = content.replace(/â˜†/g, '<span class="star-empty">â˜†</span>');
                    
                    // Display the content
                    contentElement.innerHTML = content;
                    
                    // Log success
                    console.log('Newsletter loaded successfully:', selectedFile);
                } else {
                    console.error('Failed to load newsletter:', selectedFile, 'Status:', response.status);
                    contentElement.innerHTML = `<p>Failed to load newsletter: ${selectedFile}</p><p>Status: ${response.status}</p>`;
                    
                    // Try direct content loading as fallback
                    tryDirectContentLoading(selectedFile, contentElement);
                }
            } catch (error) {
                console.error('Error loading newsletter:', error);
                contentElement.innerHTML = `<p>Error loading newsletter: ${error.message}</p>`;
                
                // Try direct content loading as fallback
                tryDirectContentLoading(selectedFile, contentElement);
            }
        }
        
        // Function to try loading content directly as a fallback
        async function tryDirectContentLoading(fileName, contentElement) {
            try {
                // For newsletter_rated_20250508.md
                if (fileName === 'newsletter_rated_20250508.md') {
                    const rawContent = await fetch('https://raw.githubusercontent.com/user/repo/main/newsletter_rated_20250508.md')
                        .then(response => response.text())
                        .catch(() => null);
                    
                    if (rawContent) {
                        contentElement.innerHTML = convertMarkdownToHtml(rawContent);
                        return;
                    }
                    
                    // If GitHub fetch fails, try to load from a hardcoded string
                    const hardcodedContent = `# This Week in Generative AI ðŸ¤– and Gaming ðŸŽ®\n2025-05-08\n\nGenerative AI continues to reshape the gaming landscape, with major investments pouring into AI-powered game development tools.  This week also saw significant advancements in AI model evaluation and applications, alongside key business developments impacting both the gaming and broader tech industries.  Player experience remains a central focus, with AI-driven enhancements and new hardware releases promising to redefine how we interact with games.\n\n## ðŸŽ® Gaming & AI\n- **Sett: Raises $27M for AI game dev tools** - *TechCrunch*\n- **Fuse Games: Secures $7M investment** - *VentureBeat*\n- **Switch 2: Projected 15M sales in 9 months** - *gamedeveloper*\n- **PlayStation: New studio formed from Bungie vets** - *gamedeveloper*\n- **Lushfoil Photography Sim: Deep dive into long-exposure system** - *gamedeveloper*\n\n## ðŸ§  Major AI Models & Features\n- **Amazon Bedrock: Adds custom metrics for generative AI evaluation** - *AWS Machine Learning Blog*\n- **Netflix: Launches generative AI-powered search using ChatGPT** - *TechCrunch & VentureBeat*\n- **Chronos Models: Powering Deutsche Bahn's forecasting on AWS** - *AWS Machine Learning Blog*\n- **WordFinder App: Uses AWS generative AI to aid aphasia communication** - *AWS Machine Learning Blog*\n\n## ðŸ’° Business & Funding News\n- **Ox Security: Raises $60M for AI code vulnerability scanning** - *TechCrunch*\n- **IBM: CEO urges increased federal AI R&D funding** - *TechCrunch*\n- **NCSoft: Invests in FPS studio Emptyvessel** - *VentureBeat*\n- **Microsoft: Wins FTC challenge to Activision deal** - *gamedeveloper*\n\n## ðŸ“Œ Other Interesting News\n- **EA: Expects accelerated growth after layoffs** - *gamedeveloper*\n\n\n**Trending topics this week:**\nGenerative Models, Player Experience, Game Development, Npc Behavior, Security Ethics\n\n\n## ðŸŒŸ Content Quality Ratings\n\n### Category Ratings\n\n- **ðŸŽ® Gaming & AI**: 3.6/5 â˜…â˜…â˜…â˜†â˜†\n- **ðŸ§  Major AI Models & Features**: 3.4/5 â˜…â˜…â˜…â˜†â˜†\n- **ðŸ’° Business & Funding News**: 3.5/5 â˜…â˜…â˜…â˜†â˜†\n- **ðŸ“Œ Other Interesting News**: 3.4/5 â˜…â˜…â˜…â˜†â˜†\n\n### Top Rated Articles\n\n1. **Game, Sett, funding: A startup building AI agents for game development emerges from stealth with $27M** - AI News & Artificial Intelligence | TechCrunch (4.0/5 â˜…â˜…â˜…â˜…â˜†)\n2. **Griffin Gaming Partners leads $7M investment in Fuse Games** - GamesBeat News | VentureBeat (4.0/5 â˜…â˜…â˜…â˜…â˜†)\n3. **Ox Security lands a fresh $60M to scan for vulnerabilities in code** - AI News & Artificial Intelligence | TechCrunch (4.0/5 â˜…â˜…â˜…â˜…â˜†)\n`;
                    
                    contentElement.innerHTML = convertMarkdownToHtml(hardcodedContent);
                    return;
                }
                
                // Fallback message if all else fails
                contentElement.innerHTML += '<p>Tried fallback methods but could not load the newsletter content.</p>';
            } catch (error) {
                console.error('Error in fallback content loading:', error);
                contentElement.innerHTML += '<p>All fallback methods failed.</p>';
            }
        }

        // Basic markdown to HTML conversion
        function convertMarkdownToHtml(markdown) {
            let html = markdown;
            
            // Headers
            html = html.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            html = html.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            
            // Bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Lists
            let lines = html.split('\n');
            let inList = false;
            let listHtml = '';
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].match(/^- /)) {
                    if (!inList) {
                        inList = true;
                        listHtml += '<ul class="article-list">';
                    }
                    listHtml += '<li>' + lines[i].substring(2) + '</li>';
                } else {
                    if (inList) {
                        inList = false;
                        listHtml += '</ul>';
                    }
                    listHtml += lines[i] + '\n';
                }
            }
            
            if (inList) {
                listHtml += '</ul>';
            }
            
            html = listHtml;
            
            // Paragraphs
            html = html.replace(/\n\n/g, '</p><p>');
            
            // Wrap in paragraphs if not already
            if (!html.startsWith('<')) {
                html = '<p>' + html + '</p>';
            }
            
            return html;
        }

        // Function to generate a new newsletter
        function generateNewsletter() {
            const statusElement = document.getElementById('generation-status');
            statusElement.className = 'status-message status-progress';
            statusElement.textContent = 'Please run the newsletter generator in your terminal...';
            statusElement.style.display = 'block';
            
            // Since we can't directly run shell scripts from the browser for security reasons,
            // we'll provide instructions to the user
            statusElement.innerHTML = 'To generate a new newsletter: <br>' +
                '1. Open your terminal <br>' +
                '2. Run this command: <br>' +
                '<code>cd /Users/danielderzic/Developer/agent-development-kit/13-newsletter-agent && python rated_newsletter_test.py</code><br>' +
                '3. After it completes, click the button below to refresh this page.';
            
            // Add a refresh button
            const refreshButton = document.createElement('button');
            refreshButton.textContent = 'Refresh Page';
            refreshButton.className = 'generate-btn';
            refreshButton.style.marginTop = '10px';
            refreshButton.onclick = function() {
                window.location.reload();
            };
            statusElement.appendChild(refreshButton);
            
            // You could also open a terminal window automatically
            // This works on macOS but requires user permission
            const openTerminalButton = document.createElement('button');
            openTerminalButton.textContent = 'Open Terminal';
            openTerminalButton.className = 'generate-btn';
            openTerminalButton.style.marginTop = '10px';
            openTerminalButton.style.marginLeft = '10px';
            openTerminalButton.style.backgroundColor = '#007bff';
            openTerminalButton.onclick = function() {
                // Create a link to open the terminal with the command
                const terminalLink = document.createElement('a');
                terminalLink.href = 'terminal://cd /Users/danielderzic/Developer/agent-development-kit/13-newsletter-agent && python rated_newsletter_test.py';
                document.body.appendChild(terminalLink);
                terminalLink.click();
                document.body.removeChild(terminalLink);
            };
            statusElement.appendChild(openTerminalButton);
        }
        
        // Load newsletter files when the page loads
        window.onload = loadNewsletterFiles;
    </script>
</body>
</html>
